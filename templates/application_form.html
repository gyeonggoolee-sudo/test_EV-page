<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>신청서 작성</title>

    <!-- CSS 파일 -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/common.css') }}">
</head>

<body class="status-{{ status }}">
    <header class="container-fluid header-wrap">
        <div class="top-title">
            <div class="top-left">
                <img class="top-logo" src="{{ url_for('static', filename='images/admin_logo.png') }}" alt="logo">
            </div>
            <div class="top-right">
                <div class="right-wrap">
                    <div class="user-wrap">
                        <div class="user-name">
                            <img class="user-icon" src="{{ url_for('static', filename='images/icon_account.png') }}"
                                alt="사용자 아이콘">
                            사용자 님
                        </div>
                        <button class="btn-black">마이페이지</button>
                        <button class="btn-black">로그아웃</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="inner">
            <div class="con-right">
                <div class="container-fluid content">
                    <div class="content-title">
                        <p class="txt-icon">
                            <span></span>
                            <span></span>
                            <span>신청관리</span>
                            <span></span>
                            <span class="on">신청서 작성</span>
                        </p>
                        <div>
                            <span>신청서 작성</span>
                        </div>
                    </div>

                    <!-- 진행 단계 버튼 -->
                    <div class="container-fluid mb25">
                        <div class="order-detail-view mb25">
                            <button type="button" id="div_step_1">지자체선택</button>
                            <button type="button" id="div_step_2" class="active">지원신청 등록/보완</button>
                            <button type="button" id="div_step_3">지원가능확인</button>
                            <button type="button" id="div_step_4">지급신청 등록/보완</button>
                            <button type="button" id="div_step_5">지급완료</button>
                        </div>
                    </div>

                    <!-- 메인 폼 -->
                    <form name="editForm" method="post" id="editForm" action="{{ url_for('submit_form') }}">
                        <!-- Hidden Fields -->
                        <input type="hidden" name="mode" value="write">
                        <input type="hidden" id="app_step1" name="app_step1" value="">
                        <input type="hidden" id="year" name="year" value="2025">
                        <input type="hidden" id="req_seq" name="req_seq" value="">
                        <input type="hidden" id="local_cd" name="local_cd" value="4113">
                        <input type="hidden" id="mem_gubun" name="mem_gubun" value="seller">
                        <input type="hidden" id="req_gubun" name="req_gubun" value="car">
                        <input type="hidden" id="car_type" name="car_type" value="11">
                        <input type="hidden" id="saveGubun" name="saveGubun" value="apply">

                        <!-- 관리정보 섹션 -->
                        <div class="container-fluid mb25" id="div_local_mng">
                            <h1>관리정보</h1>
                            <div class="table-wrap">
                                <table id="t_local_mng">
                                    <colgroup>
                                        <col width="12%">
                                        <col width="21%">
                                        <col width="12%">
                                        <col width="21%">
                                        <col width="12%">
                                        <col width="21%">
                                    </colgroup>
                                    <tbody>
                                        <tr>
                                            <th>기준년도</th>
                                            <td>2025</td>
                                            <th>지자체</th>
                                            <td>
                                                <input type="text" class="text" name="local_nm" id="local_nm"
                                                    value="성남시" readonly style="width: 52%;">
                                            </td>
                                            <th>신청단계</th>
                                            <td>
                                                <div class="form-select w50p">
                                                    <select name="app_step" id="app_step" class="select" disabled>
                                                        <option value="">=======선택=======</option>
                                                        <option value="100" selected>신청전</option>
                                                        <option value="101">신청</option>
                                                        <option value="102">신청접수</option>
                                                        <option value="110">신청보완요청</option>
                                                        <option value="120">신청승인(자격부여)</option>
                                                        <option value="130">신청승인(지원확정)</option>
                                                    </select>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>신청번호</th>
                                            <td></td>
                                            <th>신청일자</th>
                                            <td></td>
                                            <th>계약일자</th>
                                            <td>
                                                <input type="text" class="datepicker" style="width: 65%"
                                                    id="contract_day" name="contract_day" value="" readonly>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>출고기한</th>
                                            <td></td>
                                            <th>지급신청기한</th>
                                            <td></td>
                                            <th>자격 부여 일자</th>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <th>대기자선정 유형</th>
                                            <td></td>
                                            <th>공고구분</th>
                                            <td>본공고</td>
                                            <th>차종구분</th>
                                            <td>전기승용</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- 신청정보 섹션 -->
                        <div class="container-fluid mb25" id="div_req">
                            <h1>신청정보</h1>
                            <div class="table-wrap mb25">
                                <table id="t_req">
                                    <colgroup>
                                        <col width="12%">
                                        <col width="21%">
                                        <col width="12%">
                                        <col width="21%">
                                        <col width="12%">
                                        <col width="21%">
                                    </colgroup>
                                    <tbody>
                                        <tr height="60">
                                            <th>신청 유형</th>
                                            <td>
                                                <div class="form-select">
                                                    <select name="req_kind" id="req_kind" title="신청 유형"
                                                        class="myselector w60p select" {% if status=='saved'
                                                        %}disabled{% endif %}>
                                                        <option value="">==선택==</option>
                                                        <option value="P" {% if data and data.req_kind=='P' %}selected{%
                                                            endif %}>개인</option>
                                                        <option value="G" {% if data and data.req_kind=='G' %}selected{%
                                                            endif %}>단체</option>
                                                    </select>
                                                    &nbsp;&nbsp;
                                                    <label class="p_birth2" id="profit_yn_label"
                                                        style="display: none;">비영리단체<input type="checkbox"
                                                            id="profit_yn1" value=""></label>
                                                    <input type="hidden" id="profit_yn" name="profit_yn" value="N">
                                                </div>
                                            </td>
                                            <th>
                                                <p class="td_lease" style="display:none">리스 유형</p>
                                            </th>
                                            <td>
                                                <div class="td_lease" style="display:none">
                                                    <div class="form-select">
                                                        <input type="radio" class="lease_kind" name="lease_kind"
                                                            id="lease_kind1" value="P">
                                                        <label for="lease_kind1">개인</label>
                                                        <input type="radio" class="lease_kind" name="lease_kind"
                                                            id="lease_kind2" value="G">
                                                        <label for="lease_kind2">단체</label>
                                                        <div style="display:none">
                                                            <input type="radio" class="lease_kind" name="lease_kind"
                                                                id="lease_kind3" value="">
                                                            <label for="lease_kind3">없음</label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td colspan="2">
                                                <p class="p_dupvmis vmisChkYn" style=""></p>
                                                <p class="guide_sty2">* 차량등록이력조회는 임시저장(저장) 후 가능</p>
                                            </td>
                                        </tr>
                                        <tr class="tr_grp_reqst" style="display: none;" height="60">
                                            <th>
                                                <p><label class="reqInput1">*</label>신청구분</p>
                                            </th>
                                            <td colspan="5">
                                                <select name="grp_reqst_se" id="grp_reqst_se" title="구분"
                                                    class="myselector w10p">
                                                    <option value="">==선택==</option>
                                                    <option value="01">공공기관</option>
                                                    <option value="02">지자체</option>
                                                    <option value="99">기타</option>
                                                </select>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>
                                                <p class="p_birth1" style=""><label class="reqInput1">*</label>성명</p>
                                                <p class="p_birth2" style="display: none;"><label
                                                        class="reqInput1">*</label>기관명</p>
                                            </th>
                                            <td>
                                                <input type="text" class="text w90p" id="req_nm" name="req_nm"
                                                    value="{{ data.req_nm if data else '' }}" maxlength="50"
                                                    title="성명(기관명)" checknull="true" {% if status=='saved' %}disabled{%
                                                    endif %}>
                                            </td>
                                            <th>
                                                <p class="p_birth1" style=""><label class="reqInput1">*</label>생년월일</p>
                                                <p class="p_ceo" style="display: none;"><label
                                                        class="reqInput1">*</label>대표자</p>
                                            </th>
                                            <td>
                                                <div class="p_birth1" style="">
                                                    <input type="text" class="datepickerBirth" style="width: 65%"
                                                        id="birth1" value="{{ data.birth if data else '' }}"
                                                        title="생년월일" readonly {% if status=='saved' %}disabled{% endif
                                                        %}>
                                                </div>
                                                <div class="p_ceo" style="display: none;">
                                                    <input type="text" class="text" id="ceo" name="ceo" value=""
                                                        maxlength="50" title="대표자">
                                                </div>
                                                <input type="hidden" class="text" id="birth" name="birth" value="">
                                            </td>
                                            <th>
                                                <p class="p_birth1" style=""><label class="reqInput1">*</label>성별</p>
                                            </th>
                                            <td>
                                                <div class="form-select p_birth1" style="">
                                                    <input type="radio" name="req_sex" id="req_sex1" value="M">
                                                    <label for="req_sex1">남자</label>
                                                    <input type="radio" name="req_sex" id="req_sex2" value="F">
                                                    <label for="req_sex2">여자</label>
                                                    <div style="display:none">
                                                        <input type="radio" name="req_sex" id="req_sex3" value="">
                                                        <label for="req_sex3">없음</label>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr class="tr_public" style="" id="tr_pri_business" height="60">
                                            <th>
                                                <p class="p_pri_busi" style="">개인사업자</p>
                                                <p class="p_birth2" style="display: none;"><label
                                                        class="reqInput1">*</label>법인등록번호</p>
                                            </th>
                                            <td>
                                                <div class="p_pri_busi" style="">
                                                    <input type="checkbox" id="pri_business_yn1" value="">
                                                    <input type="hidden" id="pri_business_yn" name="pri_business_yn"
                                                        value="N">
                                                </div>
                                                <div class="p_birth2" style="display: none;">
                                                    <input type="text" class="text" id="birth2" name="birth2" value=""
                                                        placeholder="000000-0000000" maxlength="14" title="법인등록번호">
                                                </div>
                                            </td>
                                            <th>
                                                <p class="p_pri_busi_1" style="display: none;"><label
                                                        class="reqInput1">*</label>사업자등록번호</p>
                                            </th>
                                            <td>
                                                <div class="p_pri_busi_1" style="display: none;">
                                                    <input type="text" class="text" id="busi_no" name="busi_no" value=""
                                                        placeholder="000-00-00000" maxlength="12" title="사업자등록번호">
                                                </div>
                                            </td>
                                            <th>
                                                <p class="p_pri_busi_1" style="display: none;"><label
                                                        class="reqInput1">*</label>개인사업장명</p>
                                            </th>
                                            <td>
                                                <div class="p_pri_busi_1" style="display: none;">
                                                    <input type="text" class="text" id="pri_busi_nm" name="pri_busi_nm"
                                                        value="" maxlength="50" title="개인사업장명">
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>신청차종</th>
                                            <td>
                                                <div class="form-select w90p">
                                                    <select name="model_cd" id="model_cd" title="신청차종"
                                                        class="myselector select">
                                                        <option value="">=======선택=======</option>
                                                        <option value="MODEL3LR_C">Model 3 Long Range / 일반승용</option>
                                                        <option value="MODEL3P_C">Model 3 Performance / 일반승용</option>
                                                        <option value="MODEL3RWD">Model 3 RWD / 일반승용</option>
                                                        <option value="NEW_MODELYRWD">New Model Y RWD / 일반승용</option>
                                                        <option value="NEW_MODELYLR2">New Model Y Long Range(배터리변경) /
                                                            일반승용</option>
                                                        <option value="MODEL3LR_C1">Model 3 Long Range(배터리변경) / 일반승용
                                                        </option>
                                                    </select>
                                                </div>
                                            </td>
                                            <th>신청대수</th>
                                            <td>
                                                <input type="text" class="text intCheck" id="req_cnt" name="req_cnt"
                                                    value="" maxlength="8" title="신청대수" checknull="true">
                                            </td>
                                            <th>출고예정일자</th>
                                            <td>
                                                <input type="text" class="datepicker" style="width: 65%"
                                                    id="delivery_sch_day" name="delivery_sch_day" value=""
                                                    title="출고예정일자" readonly checknull="true">
                                            </td>
                                        </tr>
                                        <tr>
                                            <th><label class="reqInput1">*</label>주소<br>(등록주소지)</th>
                                            <td colspan="3">
                                                <input type="text" class="text w100" name="zipno" id="zipno" value=""
                                                    title="(필수입력)우편번호" readonly="readonly">
                                                <button type="button" class="type1 btn-black"
                                                    onclick="popupAddress(); return false;">
                                                    주소입력
                                                </button>

                                                <input style="width:95%;" type="text" class="text mt5" id="addr"
                                                    name="addr" value="" maxlength="200" title="주소(등록주소지)"
                                                    checknull="true" readonly="readonly"><br>
                                                <input style="width:95%;" type="text" class="text mt5" id="addr_detail"
                                                    name="addr_detail" value="" maxlength="300" title="주소(등록주소지)"
                                                    checknull="true">
                                            </td>
                                            <th>보조금신청액</th>
                                            <td>
                                                <input type="text" class="text intCheck" id="req_total_amt_1"
                                                    name="req_total_amt_1" value="" maxlength="12" title="신청 총 금액"
                                                    readonly="readonly" style="width:70%;"> 원
                                                <input type="hidden" id="req_total_amt" name="req_total_amt" value=""
                                                    maxlength="12" title="신청 총 금액" readonly="readonly">
                                                <br>
                                                <p class="req_total_amt_han"></p>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th><label class="reqInput1">*</label>연락처</th>
                                            <td colspan="5">
                                                <div style="width:33%; float:left;">
                                                    <label class="reqInput2">*</label>전화 :
                                                    <input type="text" class="text" id="phone" name="phone" value=""
                                                        maxlength="30" title="전화번호" checknull="true"
                                                        style="width: 70%;">
                                                </div>
                                                <div style="width:33%; float:left;">
                                                    <label class="reqInput2">*</label>휴대폰 :
                                                    <input type="text" class="text" id="mobile" name="mobile" value=""
                                                        maxlength="13" placeholder="010-0000-0000" title="휴대폰"
                                                        checknull="true" style="width: 70%;">
                                                </div>
                                                <div style="width:33%; float:left;">
                                                    <label class="reqInput2">*</label>이메일 :
                                                    <input type="text" class="text" id="email" name="email" value=""
                                                        maxlength="500" title="EMAIL" checknull="true"
                                                        style="width: 70%;">
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="container-fluid headdesc">
                                <p>휴대폰 번호는 '010-0000-0000' 형식으로 입력하세요.</p>
                                <p>* 은 개인정보관련 입력필수 항목입니다.</p>
                            </div>
                        </div>

                        <!-- 공동명의자 관리 섹션 -->
                        <div class="container-fluid mb25" id="div_jnInfo" style="display: none;">
                            <h1>공동명의자 관리</h1>
                            <div class="table-wrap mb25">
                                <table id="t_jnInfo1">
                                    <colgroup>
                                        <col width="12%">
                                        <col width="88%">
                                    </colgroup>
                                    <tbody>
                                        <tr>
                                            <th>공동명의자 수</th>
                                            <td>
                                                <div style="display: flex; align-items: center;">
                                                    <input type="text" class="text intCheck1" name="jn_cnt" id="jn_cnt"
                                                        value="0" maxlength="8" title="공동명의자 수"
                                                        style="width: 100px; margin-right: 5px;">
                                                    <button type="button" class="type1 btn-black"
                                                        onclick="createNewJointInfo();return false;"
                                                        style="margin-right: 10px;">
                                                        확인
                                                    </button>
                                                    <label id="l_jnCount" style="">공동명의자 정보가 없습니다.</label>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <div class="table-wrap mb25">
                                <table class="table-case1" id="t_jnInfo" style="display:none;">
                                    <colgroup>
                                        <col width="65px;">
                                        <col width="150px">
                                        <col width="100px">
                                        <col width="80px">
                                    </colgroup>
                                    <thead>
                                        <tr>
                                            <th>순번</th>
                                            <th>공동명의자 성명</th>
                                            <th>공동명의자 생년월일</th>
                                            <th>삭제</th>
                                        </tr>
                                    </thead>
                                    <tbody id="jnBody">



                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- 신청금액 섹션 -->
                        <div class="container-fluid mb25" id="div_amt">
                            <h1>신청금액</h1>
                            <div class="table-wrap mb25">
                                <table id="t_amt">
                                    <colgroup>
                                        <col width="20%">
                                        <col width="30%">
                                        <col width="20%">
                                        <col width="30%">
                                    </colgroup>
                                    <tbody>
                                        <tr>
                                            <th>국비</th>
                                            <td>
                                                <input type="text" class="text" id="req_gamt_1" name="req_gamt_1"
                                                    value="" readonly style="width:70%;"> 원
                                                <input type="hidden" id="req_gamt" name="req_gamt" value="">
                                            </td>
                                            <th>지방비</th>
                                            <td>
                                                <input type="text" class="text" id="req_lamt_1" name="req_lamt_1"
                                                    value="" readonly style="width:70%;"> 원
                                                <input type="hidden" id="req_lamt" name="req_lamt" value="">
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>추가 지방비<br>(예산지급)</th>
                                            <td>
                                                <input type="text" class="text" id="req_add_lamt_1"
                                                    name="req_add_lamt_1" value="" readonly style="width:70%;"> 원
                                                <input type="hidden" id="req_add_lamt" name="req_add_lamt" value="">
                                            </td>
                                            <th>추가 지방비<br>(별도지급)</th>
                                            <td>
                                                <input type="text" class="text" id="ext_req_add_lamt_1"
                                                    name="ext_req_add_lamt_1" value="" readonly style="width:70%;"> 원
                                                <input type="hidden" id="ext_req_add_lamt" name="ext_req_add_lamt"
                                                    value="">
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="container-fluid headdesc">
                                <p>추가지방비(별도지급) 금액은 보조금 신청액에 포함되지 않습니다.</p>
                            </div>
                        </div>

                        <!-- 신청조건 섹션 -->
                        <div class="container-fluid mb25" id="div_option">
                            <h1>신청조건</h1>
                            <div class="table-wrap mb25">
                                <table id="t_option">
                                    <colgroup>
                                        <col width="20%">
                                        <col width="30%">
                                        <col width="20%">
                                        <col width="30%">
                                    </colgroup>
                                    <tbody>
                                        <tr>
                                            <th>미세먼지 개선효과가<br>높은 차량 구매자 여부</th>
                                            <td>
                                                <div class="form-select">
                                                    <input type="radio" name="improve_fd_yn" id="improve_fd_yn1"
                                                        value="Y">
                                                    <label for="improve_fd_yn1">Y</label>
                                                    <input type="radio" name="improve_fd_yn" id="improve_fd_yn2"
                                                        value="N" checked>
                                                    <label for="improve_fd_yn2">N</label>
                                                </div>
                                            </td>
                                            <th>생애최초 차량 구매자 여부</th>
                                            <td>
                                                <div class="form-select">
                                                    <input type="radio" name="first_buy_yn" id="first_buy_yn1"
                                                        value="Y">
                                                    <label for="first_buy_yn1">Y</label>
                                                    <input type="radio" name="first_buy_yn" id="first_buy_yn2" value="N"
                                                        checked>
                                                    <label for="first_buy_yn2">N</label>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>사회계층 여부</th>
                                            <td>
                                                <div class="form-select">
                                                    <input type="radio" name="social_yn" id="social_yn1" value="Y">
                                                    <label for="social_yn1">Y</label>
                                                    <input type="radio" name="social_yn" id="social_yn2" value="N"
                                                        checked>
                                                    <label for="social_yn2">N</label>
                                                </div>
                                            </td>
                                            <th>사회계층 유형</th>
                                            <td>
                                                <div class="form-select w70p">
                                                    <select name="social_kind" id="social_kind" class="select" disabled>
                                                        <option value="">=====선택=====</option>
                                                        <option value="1">국가유공자</option>
                                                        <option value="2">장애인</option>
                                                        <option value="3">다자녀가구</option>
                                                        <option value="4">다문화가족</option>
                                                        <option value="5">기초생활수급자</option>
                                                        <option value="6">소상공인</option>
                                                        <option value="9">기타 등</option>
                                                    </select>
                                                    <select class="select" name="children_cnt" id="children_cnt"
                                                        style="width: 100px; display: none; margin-left: 5px;">
                                                        <option value="" selected="selected">===선택===</option>
                                                        <option value="2">2자녀</option>
                                                        <option value="3">3자녀</option>
                                                        <option value="4">4자녀 이상</option>
                                                    </select>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>내연기관 폐차 또는 수출말소 지원여부</th>
                                            <td>
                                                <div class="form-select">
                                                    <input type="radio" name="exchange_yn" id="exchange_yn1" value="Y">
                                                    <label for="exchange_yn1">Y</label>
                                                    <input type="radio" name="exchange_yn" id="exchange_yn2" value="N"
                                                        checked>
                                                    <label for="exchange_yn2">N</label>
                                                </div>
                                            </td>
                                            <th>어린이 통학차량용 구매자 여부</th>
                                            <td>
                                                <div class="form-select">
                                                    <input type="radio" name="school_bus_yn" id="school_bus_yn1"
                                                        value="Y">
                                                    <label for="school_bus_yn1">Y</label>
                                                    <input type="radio" name="school_bus_yn" id="school_bus_yn2"
                                                        value="N" checked>
                                                    <label for="school_bus_yn2">N</label>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>공항·항만의 시설 내부 운행 여부</th>
                                            <td>
                                                <div class="form-select">
                                                    <input type="radio" name="in_facility_yn" id="in_facility_yn1"
                                                        value="Y">
                                                    <label for="in_facility_yn1">Y</label>
                                                    <input type="radio" name="in_facility_yn" id="in_facility_yn2"
                                                        value="N" checked>
                                                    <label for="in_facility_yn2">N</label>
                                                </div>
                                            </td>
                                            <th>교통사고나 천재지변 등으로 인한 전기차 폐차 여부</th>
                                            <td>
                                                <div class="form-select">
                                                    <input type="radio" name="disaster_scrap_yn" id="disaster_scrap_yn1"
                                                        value="Y">
                                                    <label for="disaster_scrap_yn1">Y</label>
                                                    <input type="radio" name="disaster_scrap_yn" id="disaster_scrap_yn2"
                                                        value="N" checked>
                                                    <label for="disaster_scrap_yn2">N</label>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>BMS 업데이트 불가차량 폐차 후 신차 구매 여부</th>
                                            <td colspan="3">
                                                <div class="form-select">
                                                    <input type="radio" name="bms_yn" id="bms_yn1" value="Y">
                                                    <label for="bms_yn1">Y</label>
                                                    <input type="radio" name="bms_yn" id="bms_yn2" value="N" checked>
                                                    <label for="bms_yn2">N</label>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- 우선순위 배정·집행 섹션 -->
                        <div class="container-fluid mb25" id="div_priority">
                            <h1>우선순위 배정·집행</h1>
                            <div class="table-wrap mb25">
                                <table id="t_priority">
                                    <colgroup>
                                        <col width="20%">
                                        <col width="30%">
                                        <col width="20%">
                                        <col width="30%">
                                    </colgroup>
                                    <tbody>
                                        <tr>
                                            <th>우선순위 배정·집행 선택</th>
                                            <td>
                                                <div class="form-select">
                                                    <label id="l_priority_type1"><input type="radio" class="priority_type" name="priority_type" id="priority_type1" value="10" checked="checked">우선순위&nbsp;</label>
                                                    <label id="l_priority_type2" style="display:none;"><input type="radio" class="priority_type" name="priority_type" id="priority_type2" value="20">법인·기관&nbsp;</label>
                                                    <label id="l_priority_type3" style="display:none;"><input type="radio" class="priority_type" name="priority_type" id="priority_type3" value="30">중소기업&nbsp;</label>
                                                    <label id="l_priority_type5" style=""><input type="radio" class="priority_type" name="priority_type" id="priority_type5" value="40" disabled="disabled">택시&nbsp;</label>
                                                    <label id="l_priority_type6" style="display:none;"><input type="radio" class="priority_type" name="priority_type" id="priority_type6" value="50">택배&nbsp;</label>
                                                    <label id="l_priority_type4"><input type="radio" class="priority_type" name="priority_type" id="priority_type4" value="00">일반</label>
                                                </div>
                                            </td>
                                            <td>
                                                <button type="button" id="btn_priority" style="display:none;" class="btn-blue" onclick="goPriSave();return false;">우선순위 저장</button>
                                            </td>
                                            <td></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="container-fluid headdesc">
                                <p>추가지방비(별도지급) 금액은 보조금 신청액에 포함되지 않습니다.</p>
                                <p>'우선순위 배정·집행 선택'한 내용에 따라서 '우선순위' 또는 '법인·기관'으로 선택되어 총괄현황에 표시됩니다.</p>
                                <p>우선순위 항목 : '사회계층 여부', '미세먼지 개선효과가 높은 차량 구매자 여부', '생애최초 차량 구매자 여부'</p>
                                <p>법인·기관 항목 : 'K-EV100 참여 기업','친환경차 구매목표제 대상 기업' 은 법인·기관 물량으로 처리됨 (미세먼지 개선효과가 높은 차량 구매자 여부로 폐차를 선택하여도 법인·기관 물량으로 처리됨)</p>
                                <p>택시 : 개인택시, 택시 법인 모두 택시 별도 물량으로 처리됨</p>
                            </div>
                        </div>

                        <!-- 리스·렌탈 목적 차량 여부 섹션 -->
                        <div class="container-fluid mb25" id="div_lease_user">
                            <h1>리스·렌탈 목적 차량 여부(추가 보조금)</h1>
                            <div class="table-wrap mb25">
                                <table id="t_lease_user">
                                    <colgroup>
                                        <col width="11%">
                                        <col width="20%">
                                        <col width="13%">
                                        <col width="25%">
                                        <col width="10%">
                                        <col width="21%">
                                    </colgroup>
                                    <tbody>
                                        <tr>
                                            <th>리스·렌탈 목적 차량 여부</th>
                                            <td colspan="5">
                                                <div class="form-select">
                                                    <input type="radio" class="ls_user_yn" name="ls_user_yn" id="ls_user_yn1" value="Y">
                                                    <label for="ls_user_yn1">Y</label>
                                                    <input type="radio" class="ls_user_yn" name="ls_user_yn" id="ls_user_yn2" value="N" checked="checked">
                                                    <label for="ls_user_yn2">N</label>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr class="tr_lease_user_edit" style="display:none">
                                            <th>리스·렌탈 이용 유형</th>
                                            <td>
                                                <div class="form-select">
                                                    <input type="radio" class="ls_user_kind" name="ls_user_kind" id="ls_user_kind1" value="P">
                                                    <label for="ls_user_kind1">개인</label>
                                                    <input type="radio" class="ls_user_kind" name="ls_user_kind" id="ls_user_kind4" value="I">
                                                    <label for="ls_user_kind4">개인사업자</label>
                                                    <input type="radio" class="ls_user_kind" name="ls_user_kind" id="ls_user_kind2" value="G">
                                                    <label for="ls_user_kind2">단체(법인)</label>
                                                </div>
                                            </td>
                                            <th>리스·렌탈 구분(계약기준)*</th>
                                            <td colspan="3">
                                                <div class="form-select w50p">
                                                    <select name="ls_user_type" id="ls_user_type" title="리스·렌탈 구분" class="select">
                                                        <option value="">==선택==</option>
                                                        <option value="L">리스</option>
                                                        <option value="R">렌탈</option>
                                                    </select>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>이용자명의 리스·렌탈 여부</th>
                                            <td colspan="5">
                                                <div class="form-select">
                                                    <input type="radio" class="ls_user_nm_chk" name="ls_user_nm_chk" id="ls_user_nm_chk1" value="Y">
                                                    <label for="ls_user_nm_chk1">Y</label>
                                                    <input type="radio" class="ls_user_nm_chk" name="ls_user_nm_chk" id="ls_user_nm_chk2" value="N" checked="checked">
                                                    <label for="ls_user_nm_chk2">N</label>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr class="tr_lease_user_edit" style="display:none">
                                            <th>실제 이용자(계약자) 여부</th>
                                            <td colspan="5">
                                                <label><input type="radio" class="cntrctr_yn" name="cntrctr_yn" id="cntrctr_yn1" value="Y" checked="checked">Y</label>
                                                <label><input type="radio" class="cntrctr_yn" name="cntrctr_yn" id="cntrctr_yn2" value="N">N</label>
                                            </td>
                                        </tr>
                                        <tr class="tr_lease_user_edit" id="tr_cntrctr_yn1" style="display:none">
                                            <th>이용자명 / 기관명</th>
                                            <td>
                                                <input type="text" class="text" id="ls_user_nm" name="ls_user_nm" value="" maxlength="50">
                                            </td>
                                            <th>생년월일 / 사업자번호</th>
                                            <td>
                                                <input type="text" class="text" id="ls_user_busi_no" name="ls_user_busi_no" value="" maxlength="12" placeholder="000-00-00000">
                                            </td>
                                            <th>성별 / 법인번호</th>
                                            <td>
                                                <input type="text" class="text" id="ls_user_birth2" name="ls_user_birth2" value="" maxlength="14" placeholder="000000-0000000">
                                            </td>
                                        </tr>
                                        <tr class="tr_lease_user_edit" id="tr_cntrctr_yn2" style="display:none">
                                            <th>이용자 주소<br>(등록주소지)</th>
                                            <td colspan="5">
                                                <input type="text" class="text w100" name="ls_user_zipno" id="ls_user_zipno" value="" maxlength="5" readonly>
                                                <button type="button" class="type1 btn-black">주소입력</button>
                                                <input style="width:95%;" type="text" class="text mt5" id="ls_user_addr" name="ls_user_addr" value="" maxlength="200"><br>
                                                <input style="width:95%;" type="text" class="text mt5" id="ls_user_addr_detail" name="ls_user_addr_detail" value="" maxlength="300">
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="container-fluid headdesc">
                                <p>리스/렌탈사를 구분하는 것이 아닌 차량에 대한 계약 또는 판매상품 기준으로 선택(정확히 입력하지 않을 경우 추가 보조금이 취소될 수 있음)</p>
                            </div>
                        </div>

                        <!-- 제조수입사 정보 섹션 -->
                        <div class="container-fluid mb25" id="div_seller">
                            <h1>제조수입사 정보</h1>
                            <div class="table-wrap mb25">
                                <table id="t_seller">
                                    <colgroup>
                                        <col width="12%">
                                        <col width="21%">
                                        <col width="12%">
                                        <col width="21%">
                                        <col width="12%">
                                        <col width="21%">
                                    </colgroup>
                                    <tbody>
                                        <tr>
                                            <th>제조수입사</th>
                                            <td>테슬라코리아</td>
                                            <th>대리점</th>
                                            <td>테슬라코리아 1팀</td>
                                            <th>작성자</th>
                                            <td>사용자</td>
                                        </tr>
                                        <tr>
                                            <th>대리점 주소</th>
                                            <td colspan="3">서울특별시 강남구 테헤란로 134 14층</td>
                                            <th>대리점 연락처</th>
                                            <td>
                                                <input type="text" class="text" id="seller_phone" name="seller_phone"
                                                    value="" maxlength="15">
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>연락담당<br>성명</th>
                                            <td>
                                                <input type="text" class="text" id="contact_nm" name="contact_nm"
                                                    value="" maxlength="50">
                                            </td>
                                            <th>연락담당<br>휴대폰</th>
                                            <td>
                                                <input type="text" class="text" id="contact_mobile"
                                                    name="contact_mobile" value="" placeholder="010-0000-0000"
                                                    maxlength="13">
                                            </td>
                                            <th>제조수입사<br>관리(계약)번호</th>
                                            <td>
                                                <input type="text" class="text" id="seller_mgrid" name="seller_mgrid"
                                                    value="" maxlength="20">
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- 메모정보 섹션 -->
                        <div class="container-fluid mb25" id="div_memo">
                            <h1>메모정보</h1>
                            <div class="table-wrap mb25">
                                <table id="t_memo">
                                    <colgroup>
                                        <col width="20%">
                                        <col>
                                    </colgroup>
                                    <tbody>
                                        <tr>
                                            <th>신청 메모<br>(지자체 전달)</th>
                                            <td>
                                                <textarea class="textarea" name="req_memo" id="req_memo" rows="5"
                                                    cols="65" style="width: 79%" placeholder="지자체 전달 사항"></textarea>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>신청자 메모<br>(지자체 비공개)</th>
                                            <td>
                                                <textarea class="textarea" name="seller_memo" id="seller_memo" rows="5"
                                                    cols="65" style="width: 79%" placeholder="신청자 관리 메모"></textarea>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- 임시저장 후 나타날 첨부파일 영역 -->
                        {% if status == 'saved' %}
                        <div class="container-fluid mb25" id="attachment_section">
                            <h1>지원신청 첨부파일</h1>
                            <div class="table-wrap mb25">
                                <table>
                                    <colgroup>
                                        <col width="20%">
                                        <col width="47%">
                                        <col width="7%">
                                        <col width="10%">
                                    </colgroup>
                                    <tbody>
                                        <tr>
                                            <th>보조금 구매지원 신청서<br>개인정보 동의 수집이용 및 제3자 위탁 제공 동의서</th>
                                            <td>
                                                <p class="mt5" style="line-height:22px">
                                                    <button type="button" class="type1 btn-sky allow-edit"
                                                        onclick="popupAttachFile('A'); return false;">
                                                        첨부파일 등록
                                                    </button>
                                                    <!-- input type=file은 이제 안 쓰지만, 혹시 모르니 display:none으로 남겨둡니다 -->
                                                    <input type="file" id="fileInputA" style="display:none;"
                                                        onchange="handleFiles(this.files, 'A')">
                                                </p>
                                                <p class="guide_sty3" id="file_desc_A">* 첨부파일 없음</p>
                                            </td>
                                            <th>첨부파일 변경일</th>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <th>차량 구매계약서</th>
                                            <td>
                                                <p class="mt5" style="line-height:22px">
                                                    <button type="button" class="type1 btn-sky allow-edit"
                                                        onclick="popupAttachFile('B'); return false;">
                                                        첨부파일 등록
                                                    </button>
                                                    <input type="file" id="fileInputB" style="display:none;"
                                                        onchange="handleFiles(this.files, 'B')">
                                                </p>
                                                <p class="guide_sty3" id="file_desc_B">* 첨부파일 없음</p>
                                            </td>
                                            <th>첨부파일 변경일</th>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <th>개인 : 주민등록등본(초본)<br>법인(기업체) : 법인등기부등본 및 사업자등록증</th>
                                            <td>
                                                <p class="mt5" style="line-height:22px">
                                                    <button type="button" class="type1 btn-sky allow-edit"
                                                        onclick="popupAttachFile('C'); return false;">
                                                        첨부파일 등록
                                                    </button>
                                                    <input type="file" id="fileInputC" style="display:none;"
                                                        onchange="handleFiles(this.files, 'C')">
                                                </p>
                                                <p class="guide_sty3" id="file_desc_C">* 첨부파일 없음</p>
                                            </td>
                                            <th>첨부파일 변경일</th>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <th>우선순위 증빙자료</th>
                                            <td>
                                                <p class="mt5" style="line-height:22px">
                                                    <button type="button" class="type1 btn-sky allow-edit"
                                                        onclick="popupAttachFile('D'); return false;">
                                                        첨부파일 등록
                                                    </button>
                                                    <input type="file" id="fileInputD" style="display:none;"
                                                        onchange="handleFiles(this.files, 'D')">
                                                </p>
                                                <p class="guide_sty3" id="file_desc_D">* 첨부파일 없음</p>
                                                <p class="guide_sty3">*취약계층(장애인, 기초생활수급자, 상이유공자, 독립유공자), 다자녀, 소상공인,
                                                    생애최초차량 구매자, 미세먼지 개선효과가 높은 차량 구매자(택시, 노후 경유차를 전기차로 대체 구매) 등을 증빙하는 자료
                                                </p>
                                            </td>
                                            <th>첨부파일 변경일</th>
                                            <td></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        {% endif %}

                        <!-- 버튼 영역 -->
                        <div class="order-button-group mb25">
                            <button type="button" class="btn-blue" onclick="goSave(); return false;">임시저장</button>
                            <button type="submit" class="btn-blue">신청서 작성</button>
                            <button type="button" class="btn-gray allow-edit" onclick="goList(); return false;">목
                                록</button>
                        </div>
                    </form>

                    <div class="container-fluid headdesc">
                        <p>신청서 진행 단계에 따라 업무에 필요한 버튼이 표시됩니다.</p>
                        <p>[임시저장] 임시저장하고 제출하지 않은 신청서는 24시간 지난 후 야간에 삭제됩니다.</p>
                        <p>[임시저장] 후 지원신청 제출 서류를 첨부한 후 신청서를 제출해야 해당 지자체 담당자에게 서류가 접수됩니다.</p>
                        <p>[목록] 버튼을 클릭하면 신청관리 목록 화면으로 이동합니다.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <!-- jQuery 및 jQuery UI CDN -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/ui-lightness/jquery-ui.css">

    <!-- 커스텀 JavaScript -->
    <script src="{{ url_for('static', filename='js/common.js') }}"></script>

    <script>
        $(document).ready(function () {
            // 페이지 로드 시 localStorage에서 업로드된 파일 정보 확인 및 UI 업데이트
            ['A', 'B', 'C', 'D'].forEach(function(type) {
                var savedFilename = localStorage.getItem('uploaded_file_' + type);
                if (savedFilename) {
                    $('#file_desc_' + type).text("선택된 파일: " + savedFilename);
                    $('#file_desc_' + type).css('color', '#254bb5');
                }
            });

            // 모델별 보조금액 샘플 데이터
            const subsidyData = {
                'MODEL3LR_C': 1111111,
                'MODEL3P_C': 2222222,
                'MODEL3RWD': 3333333,
                'NEW_MODELYRWD': 4444444,
                'NEW_MODELYLR2': 5555555,
                'MODEL3LR_C1': 6666666
            };

            function calculateAndDisplaySubsidy() {
                const modelCode = $('#model_cd').val();
                const quantity = parseInt($('#req_cnt').val()) || 0;
                const subsidyPerCar = subsidyData[modelCode] || 0;

                const totalSubsidy = subsidyPerCar * quantity;

                // 화면에 보이는 input (콤마 포함)
                $('#req_total_amt_1').val(totalSubsidy.toLocaleString('ko-KR'));
                // form 전송용 hidden input (숫자만)
                $('#req_total_amt').val(totalSubsidy);
            }

            // 차종 선택 또는 신청대수 입력 시 계산 함수 호출
            $('#model_cd, #req_cnt').on('change keyup', calculateAndDisplaySubsidy);
        });

        function goSave() {
            if (confirm("임시저장을 하시겠습니까?")) {
                var url = "/popup/security";
                var title = "securityPopup";
                var status = "width=600,height=400,scrollbars=no,resizable=no";
                window.open(url, title, status);
            }
        }

        // 보안 팝업창에서 호출할 콜백 함수
        function tempSaveCallback(isSuccess) {
            if (isSuccess) {
                // 1. 폼 데이터를 '/save-draft'로 전송
                $.ajax({
                    type: 'POST',
                    url: '/save-draft',
                    data: $('#editForm').serialize(),
                    success: function (response) {
                        if (response.status === 'success') {
                            alert("데이터가 임시저장되었습니다. 페이지를 새로고침합니다.");
                            // 2. 성공 시 페이지 새로고침
                            window.location.href = '/?status=saved';
                        } else {
                            alert("임시저장 중 오류가 발생했습니다.");
                        }
                    },
                    error: function () {
                        alert("서버와 통신 중 오류가 발생했습니다.");
                    }
                });
            } else {
                alert("보안코드 입력에 실패했습니다.");
            }
        }

        // 첨부파일 팝업 열기
        function popupAttachFile(type) {
            var url = "/popup/attach?type=" + type;
            var title = "attachPopup";
            var status = "width=500,height=300,scrollbars=no,resizable=no";
            window.open(url, title, status);
        }

        // 팝업에서 호출할 콜백 (파일 업로드 성공 시)
        function handlePopupResult(type, filename) {
            // localStorage에 저장 (새로고침 후에도 유지하기 위함)
            localStorage.setItem('uploaded_file_' + type, filename);
            
            // 메인 페이지를 새로고침하여 실제 페이지가 다시 로드되는 UX 제공
            // window.location.reload()를 사용하면 현재 쿼리스트링(?status=saved)을 유지하며 새로고침됩니다.
            window.location.reload();
        }
    </script>
    <script>
        // 주소 팝업 열기
        function popupAddress() {
            var url = "/juso/popup";
            var title = "jusoPopup";
            var status = "width=670,height=420,scrollbars=yes,resizable=yes";
            window.open(url, title, status);
        }

        // 주소 콜백 함수 (팝업에서 호출됨)
        function jusoCallBack(roadFullAddr, roadAddrPart1, addrDetail, roadAddrPart2, engAddr, jibunAddr, zipNo) {
            // 팝업에서 전달받은 값을 입력 필드에 설정
            document.getElementById('zipno').value = zipNo;
            document.getElementById('addr').value = roadAddrPart1;
            document.getElementById('addr_detail').value = addrDetail;

            // 포커스 이동 (선택사항)
            document.getElementById('addr_detail').focus();
        }
    </script>
</body>

</html>